\subsection{Теорема дедукции в теории ИП}
Теорема дедукции для пропозиционального ИВ не может быть перенесена без изменений на произвольные теории первого порядка. Однако некоторая ослабленная форма теоремы может быть доказана для них.

Пример: $A(x) \vdash \forall xA(x)$. Вывод состоит в применении к $A(x)$ правила Gen:
\begin{enumerate}
    \item $A(x)$ (гипотеза);
    \item $\forall xA(x)$ (из 1 по Gen).
\end{enumerate}
Рассмотрим теперь интерпретацию с областью $D = \{a, b\}$. Предикат $A$ возьмём таким, что $A(a)$ истинно, а $A(b)$ ложно. Тогда формула $A(x) \supset \forall xA(x)$ не является верной, если положить свободную переменную $x = a$. Действительно, ясно, что $\forall xA(x)$ ложно, а с другой стороны, взяв значение свободной переменной $x = a$, получим, что посылка импликации будет истинной ($A(a)$ истинно), что влечёт ложность импликации.

Пусть $A$ --- формула из множества формул $\Gamma$, а $B_1, B_2, \dots, B_n$ --- некоторый вывод из $\Gamma$. Будем говорить, что формула $B_i$ \textit{зависисит от $A$ в этом выводе}, если для этой формулы выполнено какое-нибудь из условий:
\begin{enumerate}
    \item формула $B_i$ есть $A$;
    \item формула $B_i$ есть непосредственное следствие по одному из правил вывода некоторых предшествующих в этом выводе формул, из которых хотя бы одна зависит от $A$.
\end{enumerate}

\begin{lemma}\label{th:independent_formulas}
    Если формула $B$ не зависит от формулы $A$ в выводе $\Gamma, A \vdash B$, то $\Gamma \vdash B$.
\end{lemma}
\begin{proof}
    Пусть $B_1, B_2, \dots, B_n$ --- произвольный вывод $B$ из $\Gamma \cup \{A\}$, в котором $B$ независит от $A$. Ясно, что $B_n$ совпадает с $B$.

    Докажем по индукции по $n \in \mathbb{N}$ (то есть по длине вывода), что $\Gamma \vdash B_n$, то есть $\Gamma \vdash B$. Так мы докажем, что утверждение леммы верно, каков бы ни был вывод $\Gamma, A \vdash B$.

    \textbf{База}: $n = 1$. Вывод состоит всего из одной формулы --- формулы $B$. Ясно, что $B$ в таком случае не совпадает с $A$, поскольку в противном случае имела бы место зависимость $B$ от $A$, противоречащая условию леммы. В таком случае очевидно, что написанный вывод, состоящий из одной формулы, по совместительству является ещё и выводом $\Gamma \vdash B$, что доказывает базу индукции.

    \textbf{Индукционное предположение}: пусть утверждение доказано для всех выводов $\Gamma, A \vdash B$ всех длин $k \leqslant n - 1$.

    \textbf{Индукционный шаг}: докажем, что утверждение будет верно для вывода и длины $n$. Очевидно, что утверждение леммы будет верным, если окажется, что $B$ входит в $\Gamma$ или является одной из аксиом. Пусть теперь $B_n$ в нашем произвольном выводе получено из каких-то предшествующих формул $B_i$ и $B_j$ ($i, j < n$) по одному из двух правил вывода. Ясно, что поскольку $B_n$ (то есть $B$) не зависит от $A$, то ни одна из формул $B_i$ и $B_j$ не зависит от $A$. Тогда согласно индукционному предположению и произвольности формулы $B$ в формулировке леммы, получаем, что имеют место выводы $\Gamma \vdash B_i$ и $\Gamma \vdash B_j$. Тогда по правилу сечения извлекаем искомый вывод: $\Gamma \vdash B_n$.
\end{proof}

\begin{theorem}[\textit{дедукция в ИП}]
    Пусть $\Gamma, A \vdash B$ и существует вывод $B$ из $\Gamma \cup \{A\}$, в котором ни при каком применении правила Gen к формулам, зависящим в этом выводе от $A$, не связывается квантором никакая свободная переменная формулы $A$. Тогда $\Gamma \vdash A \supset B$.
\end{theorem}
\begin{proof}
    Пусть $B_1, B_2, \dots, B_n$ --- вывод $B$ из $\Gamma \cup \{A\}$, удовлетворяющий условию теоремы. Проведём доказательство индукцией по $i = 1, 2, \dots, n$ выводимостей $\Gamma \vdash A \supset B_i$. При $i = n$ получается утверждение теоремы.

    \textbf{База}: $i = 1$. Возможны следующие варианты: $B_1$ --- либо аксиома, либо формула из $\Gamma$, либо совпадает с $A$. В первых двух случаях запишем аксиому А1: $B_1 \supset (A \supset B_1)$. Далее выводем $A \supset B_1$ из написанной аксиомы и гипотезы $B_1$ по MP. Оставшийся вариант --- $B_1$ совпадает с $A$. Ясно, что $A \supset A$ выводится так же, как в это делалось в лемме \ref{th:a_supset_a} (ИВ).

    \textbf{Индукционное предположение}: пусть доказано для всех $j = 1, 2, \dots, i - 1$, что имеет место $\Gamma \vdash A \supset B_j$.

    \textbf{Шаг индукции}: докажем утверждение для $j = i$. Доступны варианты: $B_i$ --- либо аксиома, либо формула из $\Gamma$, либо совпадает с $A$, либо $B_i$ выводится из некоторых предшествующих формул по одному из правил вывода. Первые три варианта разбираются аналогично базе индукции. \\
    Если $B_i$ выводится из некоторых предшествующих по MP, то доказательство $\Gamma \vdash A \supset B_i$ аналогично доказательству в т. дедукции в ИВ. Действительно, если $B_i$ выводится из $B_r$ и $B_q$ ($r, q < i$), то $B_q$ имеет вид $B_r \supset B_i$. Тогда 
    \begin{enumerate}
        \item $\big(A \supset (\underbrace{B_r \supset B_i}_{B_q})\big) \supset \big((A \supset B_r) \supset (A \supset B_i)\big)$ (А2);
        \item $A \supset (B_r \supset B_i)$ (по индукционному предположению $\Gamma \vdash A \supset B_q$);
        \item $(A \supset B_r) \supset (A \supset B_i)$ (из 2, 1 по MP);
        \item $A \supset B_r$ (по индукционному предположению $\Gamma \vdash A \supset B_r$);
        \item $A \supset B_i$ (из 4, 3 по MP).
    \end{enumerate}

    Пусть теперь $B_i$ выводится из предшествующей формулы $B_j$ ($j < i$) по правилу Gen, то есть выполняется вывод $\dfrac{B_j}{\forall x_kB_j}$. Отсюда вытекает, что $B_i$ имеет вид $\forall x_kB_j$. По индукционному предположению справедлива выводимость $\Gamma \vdash A \supset B_j$. Имеются два случая: $B_j$ зависит от $A$ и $B_j$ не зависит от $A$. 
    \begin{itemize}
        \item Пусть зависимости $B_j$ от $A$ нет. Тогда, согласно лемме \ref{th:independent_formulas}, из выводиости $\Gamma, A \vdash B_j$ вытекает выводимость $\Gamma \vdash B_j$. Применяя правило Gen к $B_j$, получаем требуемое: $\Gamma \vdash \forall x_kB_j$, то есть $\Gamma \vdash B_i$.
        \item Пусть теперь имеет место зависимость $B_j$ от $A$ в данном выводе. Тогда по условию теоремы переменная $x_k$ не является свободной переменной формулы $A$. Значит мы имеем право записать аксиому А5: 
        \[
            \forall x_k(A \supset B_j) \supset (A \supset \forall x_kB_j).
        \]
        По индукционному предположению справедливо $\Gamma \vdash A \supset B_j$. Тогда, пользуясь правилом Gen, получаем $\Gamma \vdash \forall x_k(A \supset B_j)$, а значит из написанной аксиомы А5 и выведенного $\forall x_k(A \supset B_j)$ по MP извлекаем искомый вывод $\Gamma \vdash A \supset \forall x_kB_j$, то есть $\Gamma \vdash A \supset B_i$.
    \end{itemize}
     
\end{proof}

\begin{corollary}
    Если $\Gamma, A \vdash B$ и существует вывод $B$ из $\Gamma \cup \{A\}$, построенный без применения правила Gen к свободным переменным формулы $A$, то $\Gamma \vdash A \supset B$.
\end{corollary}

\begin{corollary}
    Если формула $A$ замкнута и $\Gamma, A \vdash B$, то $\Gamma \vdash A \supset B$.
\end{corollary}

Пример: $\vdash \forall x\forall yA(x, y) \supset \forall y\forall xA(x, y)$. Докажем вспомогательное утверждение $\forall x\forall yA(x, y) \vdash \forall y\forall xA(x, y)$:
\begin{enumerate}
    \item $\forall x\forall yA(x, y)$ (гипотеза);
    \item $\forall x\forall yA(x, y) \supset \forall yA(x, y)$ (А4, её можно применять, так как терм $t = x$ является свободным для переменной $x$ в формуле $\forall yA(x, y)$);
    \item $\forall yA(x, y)$ (из 1, 2 по MP);
    \item $\forall yA(x, y) \supset A(x, y)$ (А4, так как терм $t = y$ свободен для переменной $y$ в формуле $A(x, y)$);
    \item $A(x, y)$ (из 3, 2 по MP);
    \item $\forall xA(x, y)$ (из 5 по Gen);
    \item $\forall y\forall xA(x, y)$ (из 6 по Gen).
\end{enumerate}
В данном случае, в силу отсутствия свободных переменных в $\forall x\forall yA(x, y)$, применима теорема дедукции: 
\begin{gather*}
    \forall x\forall yA(x, y) \vdash \forall y\forall xA(x, y) \\
    \Downarrow \\
    \vdash \forall x\forall yA(x, y) \supset \forall y\forall xA(x, y).
\end{gather*}